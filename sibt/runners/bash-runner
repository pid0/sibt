#!/usr/bin/env bash

set -e
set -u
set -o pipefail

notImplStatus=200

fileToRun="$1"
shift 1
action="$1"
shift 1

writes-to() {
  return $notImplStatus
}

available-options() {
  return $notImplStatus
}

restore() {
  return $notImplStatus
}

list-files() {
  return $notImplStatus
}

versions-of() {
  return $notImplStatus
}

sync() {
  return $notImplStatus
}


get-file-type() {
  local followLinks=${2:-0}
  if ! [ -e "$1" ]; then
    echo missing
    return
  fi

  if [ -d "$1" ] && ( [ $followLinks = follow-links ] || ! [ -L "$1" ] ); then
    echo directory
  else
    echo non-directory
  fi
}

print-error() {
  echo "$(basename "$fileToRun")"' synchronizer:' "$@" >&2
}

source "$fileToRun"

setup-variables() {
  for varAssignment in "$@"; do
    local varName="${varAssignment%%=*}"
    local varValue="${varAssignment#*=}"
    declare -n variable="$varName"
    variable="$varValue"
  done
}

case $action in
  available-options) available-options;;
  sync) setup-variables "${@:1:$#}"; sync;;
  versions-of) setup-variables "${@:3:$#}"; versions-of "$@";;
  restore) setup-variables "${@:6:$#}"; restore "$@";;
  list-files) setup-variables "${@:6:$#}"; list-files "$@";;
  writes-to) writes-to;;
esac

